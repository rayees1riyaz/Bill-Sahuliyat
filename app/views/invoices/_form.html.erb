<%= form_with(model: invoice, class: "space-y-10") do |f| %>
  <% if invoice.errors.any? %>
    <div id="error_explanation" class="bg-red-50 border-l-4 border-red-500 p-6 rounded-r-xl shadow-md mb-8">
      <h2 class="text-red-900 font-bold mb-2"><%= pluralize(invoice.errors.count, "error") %> detected!</h2>
      <ul class="list-disc list-inside text-red-700 text-sm">
        <% invoice.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%# Client Details Section %>
  <section class="bg-white shadow-2xl rounded-[2rem] overflow-hidden border border-gray-100 ring-1 ring-gray-900/5">
    <div class="px-10 py-8 bg-gradient-to-r from-brand-50 to-white border-b border-gray-100 flex items-center space-x-4">
      <div class="p-3 bg-brand-600 rounded-2xl shadow-lg shadow-brand-200">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
      </div>
      <div>
        <h2 class="text-xl font-black text-gray-900 uppercase tracking-tight">Customer Information</h2>
        <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mt-0.5 italic">Billing & Contact Records</p>
      </div>
    </div>
    
    <div class="p-10 grid grid-cols-1 md:grid-cols-3 gap-10">
      <div class="md:col-span-2">
        <%= f.label :customer_name, "Business/Customer Name", class: "block text-xs font-black text-gray-400 uppercase tracking-widest mb-3 flex items-center" do %>
          <span class="mr-2">Business/Customer Name</span>
          <span class="h-px flex-grow bg-gray-100"></span>
        <% end %>
        <%= f.text_field :customer_name, placeholder: "e.g. John Doe / Global Tech Inc", class: "block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-2xl focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 focus:bg-white transition duration-300 text-gray-900 font-bold placeholder-gray-300 shadow-sm" %>
      </div>

      <div>
        <%= f.label :invoice_date, "Invoice Date", class: "block text-xs font-black text-gray-400 uppercase tracking-widest mb-3" %>
        <%= f.date_field :invoice_date, class: "block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-2xl focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 focus:bg-white transition duration-300 text-gray-900 font-bold shadow-sm" %>
      </div>

      <div class="md:col-span-3">
        <%= f.label :customer_address, "Billing Address", class: "block text-xs font-black text-gray-400 uppercase tracking-widest mb-3 flex items-center" do %>
          <span class="mr-2">Billing Address</span>
          <span class="h-px flex-grow bg-gray-100"></span>
        <% end %>
        <%= f.text_area :customer_address, rows: 2, placeholder: "Street, City, State, ZIP", class: "block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-2xl focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 focus:bg-white transition duration-300 text-gray-900 font-bold placeholder-gray-300 shadow-sm" %>
      </div>

      <div>
        <%= f.label :customer_gstin, "GSTIN Number", class: "block text-xs font-black text-gray-400 uppercase tracking-widest mb-3" %>
        <%= f.text_field :customer_gstin, placeholder: "GST Number", class: "block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-2xl focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 focus:bg-white transition duration-300 text-gray-900 font-bold placeholder-gray-300 uppercase shadow-sm" %>
      </div>

      <div>
        <%= f.label :customer_phone, "Cell/Contact", class: "block text-xs font-black text-gray-400 uppercase tracking-widest mb-3" %>
        <%= f.text_field :customer_phone, placeholder: "99xxxxxxx", class: "block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-2xl focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 focus:bg-white transition duration-300 text-gray-900 font-bold placeholder-gray-300 shadow-sm" %>
      </div>

      <div>
        <%= f.label :customer_email, "Email Address", class: "block text-xs font-black text-gray-400 uppercase tracking-widest mb-3" %>
        <%= f.email_field :customer_email, placeholder: "client@example.com", class: "block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-2xl focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 focus:bg-white transition duration-300 text-gray-900 font-bold placeholder-gray-300 shadow-sm" %>
      </div>

      <div class="md:col-span-3">
        <%= f.label :financed_by, "Financed By", class: "block text-xs font-black text-gray-400 uppercase tracking-widest mb-3 flex items-center" do %>
          <span class="mr-2">Finance Details</span>
          <span class="h-px flex-grow bg-gray-100"></span>
        <% end %>
        <%= f.text_field :financed_by, placeholder: "e.g. Bajaj Finance (Optional)", class: "block w-full px-6 py-4 bg-gray-50 border border-gray-100 rounded-2xl focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 focus:bg-white transition duration-300 text-gray-900 font-bold placeholder-gray-300 shadow-sm" %>
      </div>
    </div>
  </section>

  <%# Line Items Section %>
  <section class="bg-white shadow-2xl rounded-[2rem] overflow-hidden border border-gray-100 ring-1 ring-gray-900/5 mt-10" data-controller="invoice-items">
    <div class="px-10 py-8 bg-gradient-to-r from-brand-50 to-white border-b border-gray-100 flex items-center justify-between flex-wrap gap-4">
      <div class="flex items-center space-x-4">
        <div class="p-3 bg-brand-600 rounded-2xl shadow-lg shadow-brand-200">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-16 10a2 2 0 001 2h14a2 2 0 001-2L20 7z"></path></svg>
        </div>
        <div>
          <h2 class="text-xl font-black text-gray-900 uppercase tracking-tight">Product Details</h2>
          <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mt-0.5 italic">Itemized Goods & Services</p>
        </div>
      </div>
      
      <button type="button" data-action="invoice-items#add" class="inline-flex items-center px-6 py-3 border-2 border-brand-600 text-xs font-black rounded-xl text-brand-700 bg-white hover:bg-brand-600 hover:text-white transition duration-300 shadow-sm uppercase tracking-widest">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"></path></svg>
        Add Item
      </button>
    </div>
    
    <div class="p-10 space-y-8" data-invoice-items-target="container">
      <%= f.fields_for :line_items do |line_item| %>
        <%= render "line_item_fields", f: line_item %>
      <% end %>
    </div>

    <template data-invoice-items-target="template">
      <%= f.fields_for :line_items, LineItem.new, child_index: "NEW_RECORD" do |line_item| %>
        <%= render "line_item_fields", f: line_item %>
      <% end %>
    </template>

    <div class="px-10 py-6 bg-gray-50 border-t border-gray-100 flex justify-end">
      <div class="text-[10px] font-black text-gray-400 uppercase tracking-widest italic animate-pulse">Totals will auto-calculate on save</div>
    </div>
  </section>

  <div class="flex flex-col md:flex-row items-center justify-between gap-8 pt-10">
    <div class="text-gray-500 text-sm font-bold italic">
      Confirm all details before generating the final GST document.
    </div>
    <div class="flex items-center space-x-6 w-full md:w-auto">
      <%= link_to "Discard Changes", invoices_path, class: "flex-1 md:flex-none text-center px-8 py-4 text-gray-400 font-bold hover:text-red-500 transition uppercase tracking-widest text-xs" %>
      <%= f.submit (invoice.new_record? ? "Generate & View Invoice" : "Update & Save Invoice"), class: "flex-1 md:flex-none inline-flex items-center justify-center px-10 py-5 border border-transparent text-lg font-black rounded-2xl shadow-2xl text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-500/20 transition transform hover:-translate-y-1 active:scale-95 cursor-pointer uppercase tracking-tight" %>
    </div>
  </div>
<% end %>
