<%# Mobile Action Bar (Sticky at top for better reach) %>
<div class="md:hidden sticky top-20 z-40 bg-white/95 backdrop-blur-md border-b border-gray-100 px-4 py-3 flex items-center justify-between no-print shadow-sm overflow-x-auto gap-3">
  <%= link_to invoices_path, class: "p-2 rounded-xl bg-gray-50 text-gray-500 active:scale-90 transition" do %>
    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
  <% end %>
  <div class="flex items-center space-x-2 flex-grow justify-end">
    <%= link_to edit_invoice_path(@invoice), class: "p-2 rounded-xl bg-brand-50 text-brand-600 active:scale-95 transition" do %>
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
    <% end %>
    <button onclick="window.print()" class="px-5 py-2.5 bg-brand-600 text-white rounded-xl font-black text-[10px] uppercase tracking-widest whitespace-nowrap shadow-xl shadow-brand-200 active:scale-95 transition">
      Print Bill
    </button>
  </div>
</div>

<%# Premium Mobile View (Visible only on mobile) %>
<div class="md:hidden no-print px-4 py-6 space-y-6">
  <%# Hero Section with Pulse Animation %>
  <div class="bg-gradient-to-br from-brand-600 to-brand-800 rounded-[2.5rem] p-8 text-white shadow-2xl relative overflow-hidden animate-pop-in">
    <%# Abstract Background Shape %>
    <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"></div>
    
    <div class="flex justify-between items-start mb-6">
      <div class="flex flex-col">
        <span class="text-[10px] font-black uppercase tracking-[0.2em] opacity-60 mb-1">Grand Total</span>
        <h2 class="text-4xl font-black tracking-tight"><%= number_to_currency(@invoice.grand_total, unit: "₹", precision: 0) %></h2>
      </div>
      <span class="bg-white/20 backdrop-blur-md px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border border-white/20">Completed</span>
    </div>
    
    <div class="grid grid-cols-2 gap-4 mt-8 pt-6 border-t border-white/10">
      <div>
        <span class="text-[9px] font-black uppercase tracking-widest opacity-50 block mb-1 font-sans">Invoice Number</span>
        <span class="text-sm font-bold">#<%= @invoice.invoice_number %></span>
      </div>
      <div class="text-right">
        <span class="text-[9px] font-black uppercase tracking-widest opacity-50 block mb-1 font-sans">Billing Date</span>
        <span class="text-sm font-bold"><%= @invoice.invoice_date.strftime("%b %d, %Y") %></span>
      </div>
    </div>
  </div>

  <%# Customer Card %>
  <div class="bg-white rounded-[2rem] p-6 shadow-xl border border-gray-100 animate-pop-in" style="animation-delay: 0.1s">
    <div class="flex items-center space-x-4 mb-4">
      <div class="w-12 h-12 bg-brand-50 rounded-2xl flex items-center justify-center text-brand-600">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
      </div>
      <div>
        <h3 class="text-lg font-black text-gray-900 leading-tight"><%= @invoice.customer_name %></h3>
        <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest"><%= @invoice.customer_gstin.present? ? "GSTIN: #{@invoice.customer_gstin}" : "Direct Cash Customer" %></p>
      </div>
    </div>
    
    <% if @invoice.customer_address.present? %>
      <div class="flex items-start space-x-3 text-gray-500 mt-4">
        <svg class="w-4 h-4 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
        <p class="text-xs font-medium leading-relaxed"><%= @invoice.customer_address %></p>
      </div>
    <% end %>
  </div>

  <%# Items Section %>
  <div class="space-y-4">
    <div class="flex items-center justify-between px-2">
      <h4 class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Itemized Goods (<%= @invoice.line_items.count %>)</h4>
    </div>
    
    <% @invoice.line_items.each_with_index do |item, index| %>
      <div class="bg-white rounded-3xl p-5 shadow-lg border border-gray-50 flex justify-between items-center animate-pop-in" style="animation-delay: <%= 0.2 + (index * 0.05) %>s">
        <div class="flex flex-col max-w-[60%]">
          <span class="text-sm font-black text-gray-900 truncate"><%= item.description %></span>
          <div class="flex items-center space-x-2 mt-1">
            <span class="text-[10px] font-bold text-gray-400"><%= item.quantity %> x <%= number_to_currency(item.rate, unit: "₹", precision: 0) %></span>
            <span class="w-1 h-1 bg-gray-200 rounded-full"></span>
            <span class="text-[10px] font-bold text-brand-600"><%= item.cgst_rate + item.sgst_rate %>% Tax</span>
          </div>
        </div>
        <div class="text-right">
          <span class="text-sm font-black text-gray-900 block"><%= number_to_currency(item.amount + item.cgst_amount + item.sgst_amount, unit: "₹", precision: 0) %></span>
          <span class="text-[9px] text-gray-400 font-bold uppercase tracking-tighter">Net Total</span>
        </div>
      </div>
    <% end %>
  </div>

  <%# Summary Card %>
  <div class="bg-gray-900 rounded-[2.5rem] p-8 text-white shadow-2xl space-y-4 animate-pop-in">
    <div class="flex justify-between items-center text-sm">
      <span class="text-white/40 font-bold uppercase tracking-widest text-[10px]">Taxable Amount</span>
      <span class="font-bold"><%= number_to_currency(@invoice.sub_total, unit: "₹", precision: 0) %></span>
    </div>
    <div class="flex justify-between items-center text-sm">
      <span class="text-white/40 font-bold uppercase tracking-widest text-[10px]">Integrated Tax</span>
      <span class="font-bold"><%= number_to_currency(@invoice.cgst_total + @invoice.sgst_total, unit: "₹", precision: 0) %></span>
    </div>
    <div class="h-px bg-white/10 my-4"></div>
    <div class="flex justify-between items-center">
      <span class="text-brand-400 font-black uppercase tracking-[0.2em] text-[10px]">Payable Now</span>
      <span class="text-2xl font-black"><%= number_to_currency(@invoice.grand_total, unit: "₹", precision: 0) %></span>
    </div>
  </div>
</div>

<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-6 md:py-10 no-print">
  <div class="hidden md:flex bg-white px-8 py-6 rounded-3xl shadow-xl justify-between items-center border border-gray-100">
    <div class="flex items-center space-x-6">
      <%= link_to invoices_path, class: "p-3 rounded-full hover:bg-brand-50 text-gray-400 hover:text-brand-600 transition" do %>
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
      <% end %>
      <div>
        <h1 class="text-xl font-black text-gray-900 tracking-tight">Invoice Details</h1>
        <p class="text-xs font-bold text-gray-400 uppercase tracking-widest italic">Viewing #<%= @invoice.invoice_number %></p>
      </div>
    </div>
    
    <div class="flex items-center space-x-4">
      <%= link_to edit_invoice_path(@invoice), class: "inline-flex items-center justify-center px-8 py-3 bg-white text-gray-700 border border-gray-200 rounded-2xl font-black text-sm shadow-sm hover:bg-gray-50 transition transform hover:-translate-y-1 active:scale-95" do %>
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
        Edit Bill
      <% end %>

      <%= button_to @invoice, method: :delete, 
                    class: "inline-flex items-center justify-center px-6 py-3 bg-white text-red-600 border border-red-100 rounded-2xl font-black text-sm shadow-sm hover:bg-red-50 transition transform hover:-translate-y-1 active:scale-95",
                    data: { turbo_confirm: "Are you sure you want to delete this invoice? This action is permanent.", turbo: false } do %>
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
        Delete
      <% end %>

      <button onclick="window.print()" class="inline-flex items-center justify-center px-8 py-3 bg-brand-600 text-white rounded-2xl font-black text-sm shadow-xl hover:bg-brand-700 transition transform hover:-translate-y-1 active:scale-95">
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
        Print Bill (A4)
      </button>
    </div>
  </div>
</div>

<%# Professional Document Preview (Visible only on Desktop/Print) %>
<div class="hidden md:block print:!block">
  <div class="invoice-container main-content">
    <div class="invoice-header">
      <div class="brand-section">
        <h1>SAADAT ENTERPRISES</h1>
        <p class="font-bold">OLD ALI JAN ROAD ZOONIMAR SRINAGAR 190011</p>
        <p class="font-bold">DEALS WITH:</p>
        <p>HOME APPLIANCES, MOBILES, LAPTOPS, SOLAR, SEWING MACHINE, AC</p>
        <p>INVERTERS BATTERIES, LED, SECOND HAND MOBILES, DEEP FREEZERS & PRINTERS ETC.</p>
        <p>Email: saadatenterprises0@gmail.com</p>
        <p>Phone: 9906776815 / 9906871563</p>
        <p class="mt-2 font-bold text-black border-2 border-black inline-block px-2">GSTIN: 01BFFPR8956F2Z8</p>
      </div>
      <div class="invoice-info-section">
        <h2>TAX INVOICE</h2>
        <p><strong>Invoice No:</strong> <%= @invoice.invoice_number %></p>
        <p><strong>Date:</strong> <%= @invoice.invoice_date.strftime("%d/%m/%Y") %></p>
        <% if @invoice.financed_by.present? %>
          <p><strong>Financed By:</strong> <%= @invoice.financed_by %></p>
        <% end %>
      </div>
    </div>
  
    <div class="details-grid">
      <div class="customer-section">
        <h3>Billed To:</h3>
        <p class="text-lg font-bold text-black mb-1"><%= @invoice.customer_name %></p>
        
        <div class="customer-grid">
          <div class="address-info">
            <p class="whitespace-pre-line text-black italic"><%= @invoice.customer_address %></p>
          </div>
          <div class="contact-info border-l border-black pl-4">
            <% if @invoice.customer_phone.present? %>
              <p><span class="font-bold text-black uppercase text-[9px]">Cell:</span> <span class="font-semibold text-black"><%= @invoice.customer_phone %></span></p>
            <% end %>
            <% if @invoice.customer_email.present? %>
              <p><span class="font-bold text-black uppercase text-[9px]">Email:</span> <span class="font-semibold text-black"><%= @invoice.customer_email %></span></p>
            <% end %>
            <% if @invoice.customer_gstin.present? %>
              <p class="mt-1 pb-1 border-t border-black pt-1"><span class="font-bold text-gray-900 uppercase text-[9px]">GSTIN:</span> <span class="font-bold text-black"><%= @invoice.customer_gstin %></span></p>
            <% end %>
          </div>
        </div>
      </div>
    </div>

  <div class="table-container">
    <table class="line-items-table">
      <thead>
        <tr>
          <th style="width: 40px; text-align: left;">S.No</th>
          <th style="text-align: left;">Description of Goods</th>
          <th style="width: 50px; text-align: left;">HSN</th>
          <th style="width: 40px; text-align: left;">Qty</th>
          <th style="width: 75px; text-align: left;">Rate</th>
          <th style="width: 85px; text-align: left;">Amount</th>
          <th style="width: 65px; text-align: left;">CGST</th>
          <th style="width: 65px; text-align: left;">SGST</th>
          <th style="width: 85px; text-align: left;">Total</th>
        </tr>
      </thead>
      <tbody>
        <% @invoice.line_items.each_with_index do |item, index| %>
          <tr>
            <td style="text-align: center;"><%= index + 1 %></td>
            <td>
              <%= item.description %>
              <% if item.serial_number.present? %>
                <div class="text-[14px] text-black mt-1">S.NO/IMEI: <%= item.serial_number %></div>
              <% end %>
            </td>
            <td><%= item.hsn_code %></td>
            <td style="text-align: center;"><%= item.quantity %></td>
            <td style="text-align: right;"><%= number_to_currency(item.rate, unit: "", precision: 0) %></td>
            <td style="text-align: right;"><%= number_to_currency(item.amount, unit: "", precision: 0) %></td>
            <td style="text-align: center;">
              <%= item.cgst_rate %>%<br>
              <span class="text-xs text-black"><%= number_to_currency(item.cgst_amount, unit: "", precision: 0) %></span>
            </td>
            <td style="text-align: center;">
              <%= item.sgst_rate %>%<br>
              <span class="text-xs text-black"><%= number_to_currency(item.sgst_amount, unit: "", precision: 0) %></span>
            </td>
            <td style="text-align: right;"><%= number_to_currency(item.amount + item.cgst_amount + item.sgst_amount, unit: "", precision: 0) %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="totals-section mt-1">
    <table class="totals-table">
      <tr>
        <td class="font-bold text-black">Sub Total:</td>
        <td style="text-align: right;"><%= number_to_currency(@invoice.sub_total, unit: "₹", precision: 0) %></td>
      </tr>
      <tr>
        <td class="font-bold text-black">CGST Total:</td>
        <td style="text-align: right;"><%= number_to_currency(@invoice.cgst_total, unit: "₹", precision: 0) %></td>
      </tr>
      <tr>
        <td class="font-bold text-black">SGST Total:</td>
        <td style="text-align: right;"><%= number_to_currency(@invoice.sgst_total, unit: "₹", precision: 0) %></td>
      </tr>
      <tr class="grand-total">
        <td class="font-bold">Grand Total:</td>
        <td style="text-align: right;"><%= number_to_currency(@invoice.grand_total, unit: "₹", precision: 0) %></td>
      </tr>
    </table>
  </div>

  <div class="footer-content">
    <div class="footer-left" style="width: 70%;">
      <ul class="list-disc list-outside text-[10px] space-y-0.3 ml-4">
        <li>The GST Performa invoice is issued on the basis of item price and quantity. Item prices are liable without notice price and specification on the date of delivery. All taxes as applicable.</li>
        <li>Items once sold cannot be taken back.</li>
        <li>Check items before deliver at our showroom or go down.</li>
        <li><strong>payment:</strong><br>DD In favor of Saadat Enterprises, Srinagar.</li>
      </ul>

     
      <div class="mt-4">
        <h3 class="text-center font-bold text-sm">Bank Details</h3>
        <div class="bank-details-grid">
          <div class="bank-column">
            <p><strong>Bank:</strong> Axis Bank</p>
            <p><strong>Branch:</strong> Baghat Srinagar.</p>
            <p><strong>Account:</strong> 922020063771960</p>
            <p><strong>IFSC:</strong> utib0004849</p>
          </div>
          <div class="bank-column">
            <p><strong>JK Bank</strong></p>
            <p><strong>Upper Sathoo</strong></p>
            <p><strong>0185011110000118</strong></p>
            <p><strong>Jaka0sathoo</strong></p>
          </div>
        </div>
      </div>
    </div>

    <div class="signature-section" style="width: 25%;">
      <div style="height: 60px;"></div>
      <p class="signature-line">Authorized Signature</p>
      <p class="text-[10px] text-black font-bold uppercase">FOR SAADAT ENTERPRISES</p>
    </div>
  </div>

    <div class="mt-4 text-[10px] text-black border-t border-black pt-2">
      <p>All disputes are subject to Srinagar Jurisdiction only. E.&.O.E</p>
    </div>

  </div>
</div>
